# ストレージ：AWSソリューションアーキテクトアソシエイト

## [S3](https://aws.amazon.com/jp/s3/)

データは自動的に複数のAZへコピーされる（リージョンではない）  
有効期限付きの署名付きURLを発行できます
署名付きURLには、直接アップロードも可能（本機能を用いることでWebサーバーへの通信量を下げることができる）  
特定のユーザーのみ限定公開もできる  
標準的なファイルアクセスはサポートしていない  

### S3データ整合性

|種類|データ整合性|
|:---|:---|
|PUT（新規追加）|書き込み後の読み込み整合性、S3から完了（HTTP200）が返されるとデータ参照可能|
|PUT（更新）|結果整合性|
|DELETE（削除）|結果整合性|

※結果整合性＝[データ更新一貫性を即時担保するのではなく、更新後一定時間経過していれば正しく更新データを取得できる](https://shinkufencer.hateblo.jp/entry/2018/12/30/233000)

### S3ストレージクラス

|種類|ストレージクラス|
|:---|:---|
|スタンダード|頻繁なデータアクセスに向く|
|標準低頻度アクセス|低頻度アクセスに向く、すぐにデータが取り出せる（たとえば1時間以内にデータを提供する）|
|1ゾーン低頻度アクセス|低頻度アクセスで耐久性が低くても良くてコスト重視の場合に向く、すぐにデータが取り出せる|
|[S3 Glacier](https://aws.amazon.com/jp/glacier/)|※別項目参照|

#### [S3 Glacier](https://aws.amazon.com/jp/glacier/)

S3ストレージクラスの1つ  
もっとも安価、ロードに何時間もかかるものもある  
めったにアクセスしないデーター＝アーカイブの管理に用いる  
オンプレミスで**テープをAWSへ代替するのに用いる**  

|種類|ロードに必要な時間|
|:---|:---|
|迅速（Expedited）|1～5分|
|標準（Standard）|3～5時間|
|大容量（Bulk）|5～12時間|

データはほとんど参照されることがないものの、必要になったとき数分で取り出せるようにしたいならば上記より迅速  

#### S3暗号化

* S3パケットポリシーでデフォルト暗号化を指定し、S3で管理されるキーによるサーバーサイド暗号化を使用  
* キーを使用してすべてのデータを暗号化してからS3に保存  
* S3バケットポリシーでデフォルト暗号化を指定し、[AWS KMS](https://aws.amazon.com/jp/kms/)の管理対象キーでS3サーバーサイド暗号化を使用

## [Amazon EBS](https://aws.amazon.com/jp/ebs/)

Amazon Elastic Block Store  
EC2へ接続できるブロックレベルストレージ  
単一のEC2インスタンスにしかアタッチできない  
**スナップショットを別のリージョンへコピー可能**（別リージョンでも動作できるよう途中S3へコピーする必要はない）  
ストレージの自動拡大・縮小はサポートしていない  
暗号化は、スナップショットからコピーを作成暗号化する、**既存のEBSボリュームやEBSスナップショットへ直接暗号化オプションを設定できない**  

|種類|内容|
|:---|:---|
|Instance Store-Backedインスタンス|インスタンスストアをOSのルート領域として利用したEC2インスタンス<br>停止や再開はできない<br>**アタッチされているEC2インスタンスが再起動するとデータは失われる**<br>暗号化には対応していない|
|EBS-Backedインスタンス|EBSをOSのルート領域として利用したEC2インスタンス<br>停止や再開が可能<br>**アタッチされているEC2インスタンスが再起動してもデータは失われない、利用するアプリケーションの特性に応じてタイプを選択できる**|

### [EBSボリューム特性](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/EBSVolumeTypes.html)

|--|種類|内容|
|:---|:---|:---|
|SSD|汎用SSD|価格とパフォーマンスのバランスが良い|
||プロビジョンドIOPS SSD|パフォーマンスを最大限に引き出す|
|HDD|スループット最適化HDD|HDDの中ではスループットが高い、低コスト、ビッグデータ向け|
||cold HDD|アクセス頻度の低いワークロード向け・低コスト|
|旧世代|マグネティック|EBSにおいてアクセス頻度が低い用途に適した旧世代のHDD|

大規模データベースでEBSのI/Oスループットを最大化するため、EBS最適化オプションとともに利用するボリュームタイプのEBSはプロビジョンドIOPS SSD  

### EBS暗号化

既存EBSボリュームは一度スナップショットを取得してそのコピーを作成するときに暗号化できる  

EBSボリュームの暗号化は、スナップショットを作成しコピーし（ここで暗号化オプションを有効化する）ボリュームを作成し、EC2インスタンスから既存ボリュームをでタッチしたあと作成したボリュームをアタッチする  

## IOPS

ハードディスクなどの記憶装置の性能指標の1つで、ある条件の元で1秒間に読み込み・書き込みできる回数のこと  

## [Amazon EFS](https://aws.amazon.com/jp/efs/)

Elastic File System  
標準的なファイルシステムをサポート  
ストレージの自動拡大・縮小もサポート  

## [AWS Storage Gateway](https://aws.amazon.com/jp/storagegateway/)

ローカルキャッシング対応のハイブリッドクラウドストレージ  
バックエンドがS3  
オンプレミスのアプライアンス（例:社内業務サーバー）と接続し、S3などのストレージソリューションにアクセスしてデータを保存でき、バックアップも行える  
透過的に保存データの暗号化が可能  

## スナップショットとAMIの違い

AMIはAmazon Machine Imageの略

|種類|内容|
|:---|:---|
|スナップショット|ストレージのバックアップ|
|AMI|OS設定をイメージとして保持し、新規インスタンス設定の転用に用いる<br>スナップショットも含まれるので、AMI作成時点のスナップショットも復元可能|
